require('./Globals');

// User imports
let AuthSession = invoke('Server/Auth/Session');
let GameSession = invoke('Server/Game/Session');
let Config      = invoke('Config');
let Database    = invoke('Database');
let Server      = invoke('Server');
let Utils       = invoke('Utils');

console.log('# ================================');
console.log('# Server Name: ...... NodeL2 [768]');
console.log('# Build Revision: ... %s', Utils.buildNumber());
console.log('# Chronicle: ........ C5');
console.log('# Build date: ....... %s', Utils.currentDate());
console.log('# NodeJS version: ... %s', Utils.nodeVersion());
console.log('# ================================\n');

// Startup procedure, first `Database`, then `AuthServer`, finally `GameServer`
Database.init(() => {
    new Server('AuthServer', Config.authServer, (socket) => { return new AuthSession(socket); });
    new Server('GameServer', Config.gameServer, (socket) => { return new GameSession(socket); });
});

// XOR
// 00 00 00 77 1d e7 00 00 00 00 0f 21 ce 01 13 4d af 5b 5d 1c dd b3 d3 19 5c cd 11 69 ab e4 e9 67 be ea b9 cd 0e 8f a0 f5 4a 39 23 72 3d 6f 94 89 ff 2c 1b 6f ec 9e 25 16 35 d5 07 4b ac c8 26 93 ef 8e 1c 8e d2 da c3 5b 11 e1 e0 58 97 7a ea 5d b4 57 2d 27 fe e2 d8 ad a8 ef d9 64 5f f1 44 db 4a ac ac 16 11 d9 1e fa ec d6 c7 16 2f 10 24 8c 34 30 6f ea 30 3d f9 30 b1 c7 64 31 7e 41 f4 48 15 9f 3f ae 0c cb 69 2d e5 c9 43 6a b9 df 04 6a b9 df 04 6a b9 df 04 6a b9 df 04 be 79 60 04 d5 26 ab a1 e8 3f c4 30 fc ec 78 bd 90 80 14 d1 90 80 14 d1 90 80 14 d1 90 80 14 d1 90 80 14 00 00 00 00

// Blowfish
// 00 00 91 9e a4 db f7 7a f9 64 48 a3 58 b1 fc 45 64 60 ff 28 ce a5 f5 74 37 dc 00 03 62 a1 a3 24 74 33 37 a2 70 51 7f 97 d9 34 d8 5f 38 cc e1 99 22 00 e2 80 5b 22 d5 9c f9 73 86 74 fc fc d7 40 1b d2 76 52 ba ac 17 f6 a9 5c a9 0e 76 e6 64 7e 0b 8f 51 58 8c ba 5c ff f1 44 43 bf 7b 3f 36 af 76 dd 0d 09 a9 81 9e 93 b6 83 2e 1b 40 29 6e 5f 4c b4 fa 02 24 af 20 6a 09 5d 5e 8e 26 7d 02 4c fa c5 89 12 c8 20 90 c7 c4 07 d3 d4 be 21 5e 98 c4 43 cc 2d f0 51 f0 92 eb 31 38 eb ea c7 6e e5 3f 52 56 af d8 ec fe d0 c5 4a 87 e0 06 28 c7 c5 67 11 f1 31 94 7d 4b 2f 76 3e 20 d7 e6 b4 61 44 f3 66

//let buffer = Buffer.from([0x00,0x77,0x1d,0xe7,0x00,0x00,0x00,0x00,0x0f,0x21,0xce,0x01,0x13,0x4d,0xaf,0x5b,0x5d,0x1c,0xdd,0xb3,0xd3,0x19,0x5c,0xcd,0x11,0x69,0xab,0xe4,0xe9,0x67,0xbe,0xea,0xb9,0xcd,0x0e,0x8f,0xa0,0xf5,0x4a,0x39,0x23,0x72,0x3d,0x6f,0x94,0x89,0xff,0x2c,0x1b,0x6f,0xec,0x9e,0x25,0x16,0x35,0xd5,0x07,0x4b,0xac,0xc8,0x26,0x93,0xef,0x8e,0x1c,0x8e,0xd2,0xda,0xc3,0x5b,0x11,0xe1,0xe0,0x58,0x97,0x7a,0xea,0x5d,0xb4,0x57,0x2d,0x27,0xfe,0xe2,0xd8,0xad,0xa8,0xef,0xd9,0x64,0x5f,0xf1,0x44,0xdb,0x4a,0xac,0xac,0x16,0x11,0xd9,0x1e,0xfa,0xec,0xd6,0xc7,0x16,0x2f,0x10,0x24,0x8c,0x34,0x30,0x6f,0xea,0x30,0x3d,0xf9,0x30,0xb1,0xc7,0x64,0x31,0x7e,0x41,0xf4,0x48,0x15,0x9f,0x3f,0xae,0x0c,0xcb,0x69,0x2d,0xe5,0xc9,0x43,0x6a,0xb9,0xdf,0x04,0x6a,0xb9,0xdf,0x04,0x6a,0xb9,0xdf,0x04,0x6a,0xb9,0xdf,0x04,0xbe,0x79,0x60,0x04,0xd5,0x26,0xab,0xa1,0xe8,0x3f,0xc4,0x30,0xfc,0xec,0x78,0xbd,0x90,0x80,0x14,0xd1,0x90,0x80,0x14,0xd1,0x90,0x80,0x14,0xd1,0x90,0x80,0x14,0xd1,0x90,0x80,0x14,0x00,0x00,0x00,0x00]);
//
//let key = Buffer.from([0x6b,0x60,0xcb,0x5b,0x82,0xce,0x90,0xb1,0xcc,0x2b,0x6c,0x55,0x6c,0x6c,0x6c,0x6c]);
//
//let Blowfish = require('blowfish-ecb');
//
//Utils.dumpBuffer(Blowfish.encipher(key, buffer));
