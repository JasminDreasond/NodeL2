require('./Globals');

// User imports
let AuthSession = invoke('Server/Auth/Session');
let GameSession = invoke('Server/Game/Session');
let Config      = invoke('Config');
let Database    = invoke('Database');
let Server      = invoke('Server');
let Utils       = invoke('Utils');

console.log('# ================================');
console.log('# Server Name: ...... NodeL2 [768]');
console.log('# Build Revision: ... %s', Utils.buildNumber());
console.log('# Chronicle: ........ C5');
console.log('# Build date: ....... %s', Utils.currentDate());
console.log('# NodeJS version: ... %s', Utils.nodeVersion());
console.log('# ================================\n');

// Startup procedure, first `Database`, then `AuthServer`, finally `GameServer`
Database.init(() => {
    new Server('AuthServer', Config.authServer, (socket) => { return new AuthSession(socket); });
    new Server('GameServer', Config.gameServer, (socket) => { return new GameSession(socket); });
});

//let or = Buffer.from([0x00,0x00,0x00,0x77,0x1d,0xe7,0x00,0x00,0x00,0x00,0x0f,0x21,0xce,0x01,0x13,0x4d,0xaf,0x5b,0x5d,0x1c,0xdd,0xb3,0xd3,0x19,0x5c,0xcd,0x11,0x69,0xab,0xe4,0xe9,0x67,0xbe,0xea,0xb9,0xcd,0x0e,0x8f,0xa0,0xf5,0x4a,0x39,0x23,0x72,0x3d,0x6f,0x94,0x89,0xff,0x2c,0x1b,0x6f,0xec,0x9e,0x25,0x16,0x35,0xd5,0x07,0x4b,0xac,0xc8,0x26,0x93,0xef,0x8e,0x1c,0x8e,0xd2,0xda,0xc3,0x5b,0x11,0xe1,0xe0,0x58,0x97,0x7a,0xea,0x5d,0xb4,0x57,0x2d,0x27,0xfe,0xe2,0xd8,0xad,0xa8,0xef,0xd9,0x64,0x5f,0xf1,0x44,0xdb,0x4a,0xac,0xac,0x16,0x11,0xd9,0x1e,0xfa,0xec,0xd6,0xc7,0x16,0x2f,0x10,0x24,0x8c,0x34,0x30,0x6f,0xea,0x30,0x3d,0xf9,0x30,0xb1,0xc7,0x64,0x31,0x7e,0x41,0xf4,0x48,0x15,0x9f,0x3f,0xae,0x0c,0xcb,0x69,0x2d,0xe5,0xc9,0x43,0x6a,0xb9,0xdf,0x04,0x6a,0xb9,0xdf,0x04,0x6a,0xb9,0xdf,0x04,0x6a,0xb9,0xdf,0x04,0xbe,0x79,0x60,0x04,0xd5,0x26,0xab,0xa1,0xe8,0x3f,0xc4,0x30,0xfc,0xec,0x78,0xbd,0x90,0x80,0x14,0xd1,0x90,0x80,0x14,0xd1,0x90,0x80,0x14,0xd1,0x90,0x80,0x14,0xd1,0x90,0x80,0x14,0x00,0x00,0x00,0x00]);
//
//invoke('Utils').dumpBuffer(invoke('Cipher/Blowfish').encrypt(or.slice(2)));

let hi = Buffer.from([0x00,0x00,0x91,0x9e,0xa4,0xdb,0xf7,0x7a,0xf9,0x64,0x48,0xa3,0x58,0xb1,0xfc,0x45,0x64,0x60,0xff,0x28,0xce,0xa5,0xf5,0x74,0x37,0xdc,0x00,0x03,0x62,0xa1,0xa3,0x24,0x74,0x33,0x37,0xa2,0x70,0x51,0x7f,0x97,0xd9,0x34,0xd8,0x5f,0x38,0xcc,0xe1,0x99,0x22,0x00,0xe2,0x80,0x5b,0x22,0xd5,0x9c,0xf9,0x73,0x86,0x74,0xfc,0xfc,0xd7,0x40,0x1b,0xd2,0x76,0x52,0xba,0xac,0x17,0xf6,0xa9,0x5c,0xa9,0x0e,0x76,0xe6,0x64,0x7e,0x0b,0x8f,0x51,0x58,0x8c,0xba,0x5c,0xff,0xf1,0x44,0x43,0xbf,0x7b,0x3f,0x36,0xaf,0x76,0xdd,0x0d,0x09,0xa9,0x81,0x9e,0x93,0xb6,0x83,0x2e,0x1b,0x40,0x29,0x6e,0x5f,0x4c,0xb4,0xfa,0x02,0x24,0xaf,0x20,0x6a,0x09,0x5d,0x5e,0x8e,0x26,0x7d,0x02,0x4c,0xfa,0xc5,0x89,0x12,0xc8,0x20,0x90,0xc7,0xc4,0x07,0xd3,0xd4,0xbe,0x21,0x5e,0x98,0xc4,0x43,0xcc,0x2d,0xf0,0x51,0xf0,0x92,0xeb,0x31,0x38,0xeb,0xea,0xc7,0x6e,0xe5,0x3f,0x52,0x56,0xaf,0xd8,0xec,0xfe,0xd0,0xc5,0x4a,0x87,0xe0,0x06,0x28,0xc7,0xc5,0x67,0x11,0xf1,0x31,0x94,0x7d,0x4b,0x2f,0x76,0x3e,0x20,0xd7,0xe6,0xb4,0x61,0x44,0xf3,0x66]);

//invoke('Utils').dumpBuffer(hi.slice(2));
invoke('Utils').dumpBuffer(invoke('Cipher/Blowfish').decrypt(hi.slice(2)));

//let hi = Buffer.from([0x00,0x00,0x91,0x9e,0xa4,0xdb,0xf7,0x7a,0xf9,0x64,0x48,0xa3,0x58,0xb1,0xfc,0x45,0x64,0x60,0xff,0x28,0xce,0xa5,0xf5,0x74,0x37,0xdc,0x00,0x03,0x62,0xa1,0xa3,0x24,0x74,0x33,0x37,0xa2,0x70,0x51,0x7f,0x97,0xd9,0x34,0xd8,0x5f,0x38,0xcc,0xe1,0x99,0x22,0x00,0xe2,0x80,0x5b,0x22,0xd5,0x9c,0xf9,0x73,0x86,0x74,0xfc,0xfc,0xd7,0x40,0x1b,0xd2,0x76,0x52,0xba,0xac,0x17,0xf6,0xa9,0x5c,0xa9,0x0e,0x76,0xe6,0x64,0x7e,0x0b,0x8f,0x51,0x58,0x8c,0xba,0x5c,0xff,0xf1,0x44,0x43,0xbf,0x7b,0x3f,0x36,0xaf,0x76,0xdd,0x0d,0x09,0xa9,0x81,0x9e,0x93,0xb6,0x83,0x2e,0x1b,0x40,0x29,0x6e,0x5f,0x4c,0xb4,0xfa,0x02,0x24,0xaf,0x20,0x6a,0x09,0x5d,0x5e,0x8e,0x26,0x7d,0x02,0x4c,0xfa,0xc5,0x89,0x12,0xc8,0x20,0x90,0xc7,0xc4,0x07,0xd3,0xd4,0xbe,0x21,0x5e,0x98,0xc4,0x43,0xcc,0x2d,0xf0,0x51,0xf0,0x92,0xeb,0x31,0x38,0xeb,0xea,0xc7,0x6e,0xe5,0x3f,0x52,0x56,0xaf,0xd8,0xec,0xfe,0xd0,0xc5,0x4a,0x87,0xe0,0x06,0x28,0xc7,0xc5,0x67,0x11,0xf1,0x31,0x94,0x7d,0x4b,0x2f,0x76,0x3e,0x20,0xd7,0xe6,0xb4,0x61,0x44,0xf3,0x66]);
//
//console.log(hi.byteLength);
//Utils.dumpBuffer(hi);

// Clean
// 00 00 00 77 1d e7 0f 21 c6 00 00 9a 94 c6 2e 59 6a ea 12 e4 0e 89 c2 b0 c4 e9 08 74 1d f2 6e a5 44 6a d9 27 cb 87 bd 87 47 9e 57 05 1a 74 73 1d ec 59 3e 7d ff 35 d8 22 91 1d e5 3b 07 b6 3a 15 22 28 21 c5 23 ba 63 0c 7e c8 ba 84 fc 29 c9 42 66 0a 05 4c 96 4f 7f 71 62 a1 1d 5c 6a 55 d0 d1 bb 14 4e 0f 72 90 df f4 c5 c6 23 6d 03 c0 3b 5a 04 fb a8 1a 40 7b 1d e0 e8 f8 48 f6 92 2f e7 d2 1e 58 d6 8a 51 02 d4 44 5c 16 47 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 6b 60 cb 5b 82 ce 90 b1 cc 2b 6c 55 6c 6c 6c 6c

// XOR
// 00 00 00 77 1d e7 00 00 00 00 0f 21 ce 01 13 4d af 5b 5d 1c dd b3 d3 19 5c cd 11 69 ab e4 e9 67 be ea b9 cd 0e 8f a0 f5 4a 39 23 72 3d 6f 94 89 ff 2c 1b 6f ec 9e 25 16 35 d5 07 4b ac c8 26 93 ef 8e 1c 8e d2 da c3 5b 11 e1 e0 58 97 7a ea 5d b4 57 2d 27 fe e2 d8 ad a8 ef d9 64 5f f1 44 db 4a ac ac 16 11 d9 1e fa ec d6 c7 16 2f 10 24 8c 34 30 6f ea 30 3d f9 30 b1 c7 64 31 7e 41 f4 48 15 9f 3f ae 0c cb 69 2d e5 c9 43 6a b9 df 04 6a b9 df 04 6a b9 df 04 6a b9 df 04 be 79 60 04 d5 26 ab a1 e8 3f c4 30 fc ec 78 bd 90 80 14 d1 90 80 14 d1 90 80 14 d1 90 80 14 d1 90 80 14 00 00 00 00

// Blowfish
// 00 00 91 9e a4 db f7 7a f9 64 48 a3 58 b1 fc 45 64 60 ff 28 ce a5 f5 74 37 dc 00 03 62 a1 a3 24 74 33 37 a2 70 51 7f 97 d9 34 d8 5f 38 cc e1 99 22 00 e2 80 5b 22 d5 9c f9 73 86 74 fc fc d7 40 1b d2 76 52 ba ac 17 f6 a9 5c a9 0e 76 e6 64 7e 0b 8f 51 58 8c ba 5c ff f1 44 43 bf 7b 3f 36 af 76 dd 0d 09 a9 81 9e 93 b6 83 2e 1b 40 29 6e 5f 4c b4 fa 02 24 af 20 6a 09 5d 5e 8e 26 7d 02 4c fa c5 89 12 c8 20 90 c7 c4 07 d3 d4 be 21 5e 98 c4 43 cc 2d f0 51 f0 92 eb 31 38 eb ea c7 6e e5 3f 52 56 af d8 ec fe d0 c5 4a 87 e0 06 28 c7 c5 67 11 f1 31 94 7d 4b 2f 76 3e 20 d7 e6 b4 61 44 f3 66